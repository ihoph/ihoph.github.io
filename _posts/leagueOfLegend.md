# 롤에 빗대어 AOP 이해하기

[토비의 스프링 6장 정리](https://p-vibe.github.io/2020/02/17/toby06/)에서 AOP를 정리한 적이 있습니다. 이 때는 딱딱하게 책을 정리했었는데, 이 포스트에서는 좀 가볍게(?) AOP를 정리하려고 합니다. AOP를 읽으며 저는 예전에 제가 하던 게임 리그오브레전드가 자꾸 생각났는데요. AOP의 개념을 리그오브레전드에 빗대어 써보겠습니다. 추후 예제코드도 작성해서 올릴 예정이고요. 제 생각에는 롤을 아는 사람들은 이 글이 토비의스프링 6장보다 훨씬 쉽게 느껴질 것 같은데, [스터디](https://github.com/de-labtory/sc)에서 AOP를 롤에 빗대어 설명했다가 "롤 몰라서 더 어렵다", "롤도 알고 토비의스프링 6장도 읽어봤는데 뭔 말인지 모르겠고 더 어렵게 느껴진다"라는 피드백을 받은 적이 있어서 이 글이 쉬울 지 확신은 없습니다...^^; 목차는 다음과 같습니다.



## 1. 사전지식

서론에서 언급하였듯이, 롤을 모르는 사람들에게는 오히려 더 어렵습니다. 그리고 롤에 빗댔다고는 했지만, AOP의 개념과 롤이 완전히 매칭되지 않아, 제가 새로 만든 개념들이 있기 때문에  롤을 알아도 어려울 수 있습니다. 그래서 롤 말고도 다른 사전지식도 필요합니다. 제가 생각하는 사전지식은 다음과 같습니다.

1. **리그오브레전드 지식**
2. **IOC**
3. **OCP**
4. **interface를 활용한 추상화**
5. 개발자 테스트
6. 템플릿/콜백 패턴

제가 생각하기엔 이 정도 지식이면 충분할 것 같은데... 혹시 추후에 더 생각나면 추가하겠습니다. 굵게 표시한 것은 꼭 필요한 사전지식이고, 얇은 글씨는 꼭 알진 않아도 되는 사전지식입니다.

## 2. 태초에 롤은....

저는 2011년에 친구의 제안으로 처음 롤을 접했습니다. 그래서 롤의 역사를 어느정도 알죠. 지금은 롤이 굉장히 체계가 있지만, 처음에 그렇지 않았습니다. 탑, 정글, 미드, 원딜, 서포터같은 역할이 정해져있지 않았고, 사용자마다 중구난방으로 가고 싶은 곳을 가며 협곡을 누볐죠. 그러다가 사용자들이 경험을 쌓으면서, 탑에 1명, 정글에 1명, 미드에 1명, 봇에 2명 가는 게 승률이 좋다는 걸 알게됩니다. 이 경험이 점점 정석화되면서, 사용자들끼리 규칙을 정합니다. 사용자들이 챔피언을 고르는 화면에 들어서면, "탑 선", "미드 선"과 같이 자기가 먼저라고 주장하면, 그 위치는 그 사람 차지인 것이 문화가 됐죠. 이러한 문화가 워낙 공공연하다보니, 라이엇에서는 아예 챔피언을 고르는 화면을 바꿔 탑, 미드 등 위치를 명시해줬습니다. 저는 '객체지향의 탄생도 이렇지 않았을까?' 라는 생각이 들었습니다. 처음에는 중구난방으로 코드를 짜다가, 점점 "이 코드는 여기 있을 게 아니라, 저기 있는게 좋겠다" 라는 생각으로 발전하고, 관심사를 분리해주는 것이 공공연해지지 않았을까 하는 추측을 한 것입니다. 그리고 롤을 오래 보신 분들은 아시겠지만, 초기에 서포터라는 개념이 굉장히 애매모했습니다. 서포터라는 명칭보다는 "봇 2명"이라는 게 오히려 자연스러웠죠. 그러다가 사용자들의 경험이 쌓이면서, 봇 두명 중 한명은 다른 한명을 돕는 것에만 집중하는 게 낫다는 결론이 납니다. 이 때부터 서포터라는 개념이 생겼죠. 제가 AOP를 공부하면서 롤이 생각난 게 바로 이 점 때문입니다. 지난 토비의스프링 6장 정리에서 제가 앞 부분에 "AOP는 흩어진 부가기능을 모듈화하여, 핵심기능에 부가기능을 투명하게 부여해주는 것이다". 라고 쓴 적이 있습니다. 바로 이 "부가기능"!. 롤에서 서포터의 힐과 같죠. 그래서 토비의스프링 6장에서 설명해주는 내용을 롤과 매칭시켜봤습니다.

## 3. 용어 설명

본격적으로 설명드리기 전, 용어를 정리해보겠습니다. 이 정리는 찾아보기 쉽게 앞부분에서 정리한 것 뿐이고, 지금 당장 아셔야하는 것이 아닙니다. 특히 롤을 해보셨던 분도 롤에 없는 용어를 보고는 어렵다고 생각하실 수 있는데, 천천히 읽어보시다보면 이해가 되실 거라고 믿습니다. 여기서 베인, 소라카라고 써놨는데 그냥 원딜, 서포터 중 생각나는 거 아무거나 적어놓은 것입니다. 쓰다보면 케이틀린이 나올 수도 있고 타릭이 나올 수도 있는데 원딜, 서폿 중 아무거나 적은거라고 생각해주세요.

| 롤                                                    | 토비의 스프링                                                |
| ----------------------------------------------------- | ------------------------------------------------------------ |
| 유저                                                  | 클라이언트                                                   |
| 챔피언                                                | 클래스                                                       |
| 스킬(q,w,e,r)                                         | 메소드                                                       |
| 베인                                                  | 핵심기능 인터페이스                                          |
| 베인스킨(클래식 베인, 귀족 베인 등)                   | 핵심기능 구현체                                              |
| 위장한 서포터(별수호자 소라카 등)                     | 프록시                                                       |
| 게시판                                                | IoC Context                                                  |
| 조수/향상된조수(룰루로 치면 옆에 붙어다니는 애임)     | InvocationHandler/Interceptor(Advice)                        |
| 향상된조수의 조수(도저히 롤에 매칭을 못시켰습니다...) | MethodInvocation                                             |
| 해커                                                  | 다이내믹 프록시(라고 생각하셔도 될 것 같아요. AOP를 완전히 적용했을 땐 아마 다른 객체가 Reflection을 활용할텐데, 완전 적용 전 중간 쯤 다이내믹프록시가 Reflection을 사용하기 때문입니다.) |

## 4. 이런 상황을 가정해봅시다

사실 롤과 토비의 스프링 6장은 완전히 매칭되진 않아요. 매칭시키기 위해 다음과 같은 상황을 가정했습니다.

*베인이 q를 쓰면, 구르면서 상대방에게 큰 타격을 입힐 수 있지만, 대신 자기 자신의 체력도 조금 깎인다. 베인은 이러한 단점을 극복하기 위해, q를 쓰자마자 마우스 좌클릭, 우클릭을 1초만에 연속으로 누르면 깎였던 체력이 깎인만큼 찬다.*

베인은 q로 큰 딜을 넣을 수 있지만, 자가 힐까지 하려면 컨트롤이 너무 어려워 딜에 집중할 수가 없습니다... 이런 상황을 개선하면서 AOP를 적용해볼 것입니다.

> 억지로 매칭시킨 점 양해해주세요...^^; 다만, 충분히 그럴듯한 상황인 것 같아요. 예전에 바람의나라를 하신 분들이라면 아실텐데, 바람의나라에서 만렙전사가 동귀어진이라는 스킬을 쓰면, 상대방에게 엄청난 타격을 주는 대신 자기 자신의 체력도 상당히 많이 깎입니다. 그래서 도사가 옆에서 바로 힐을 줘야 하죠. 이것과 유사한 상황이라고 생각해주시면 감사하겠습니다!



## 5. 새로운 스킬을 두자

q를 쓴다음에 바로 마우스 왼쪽, 오른쪽을 눌러야 힐이 된다니... 너무 어렵습니다. 아예 새로운 스킬 t를 두고, t를 힐로 만듭니다. 이제 베인은 q를 쓰자마자 t를 누르면 됩니다. 이전보다는 나은 것 같네요. 하지만 다른 애들은 q,w,e,r만 신경쓰면 되는데 베인을 조종하는 사람은 q,w,e,r,t를 신경써야 해서 여전히 딜에 온전히 집중할 수 없습니다! 

<!--토비의 스프링과 매칭: 메소드 분리-->



## 6. 아예 힐을 베인에서 빼자

베인이 컨트롤을 해서 힐을 해야한다는 것 자체로 베인은 딜에 온전히 집중할 수가 없는 것입니다. 그렇다면 해결책은 베인에서 힐 능력을 아예 빼버리는 것이죠. 대신 서포터를 두고 그 서포터가 힐을 해주기로 합니다. 이렇게 했을 때 장단점이 명확합니다.

- 장점
  1. 베인이 딜에 집중할 수 있음.
  2. 테스트하기 좋음 - 힐 추상화에 의존하지 않게 되니, 고립된 테스트가 가능함.
- 단점
  1. 서포터가 힐을 안주면 베인은 q를 쓸 때 체력이 닳기만 하고 체력이 차질 않음. 어쩌면 차라리 컨트롤 어렵게 하고 베인이 스스로 힐 하는 게 나을 수도 있는 것임.

<!--토비의 스프링과 매칭: 클래스 분리-->

## 7. 서포터의 위장

베인에 힐 기능이 없어졌다는 치명적인 단점을 극복하기 위해 서포터(소라카)가 힘을 씁니다. 소라카는 자기 자신을 베인처럼 꾸미고 사용자에게 이렇게 말합니다.

*"내가 베인이야~ 날 베인이라고 생각해도 되는데, 왜냐면 날 컨트롤하면 베인이 저절로 공격할거야~"*

 실제로 사용자는 소라카를 움직였을 뿐인데, 베인이 알아서 구르면서 상대에게 딜을 넣습니다. 사용자가 소라카를 컨트롤하고 있기 때문에 베인에게 힐을 넣기란 식은 죽 먹기입니다. 

근데 만약에... 소라카가 스스로 베인이라고 아무리 주장해도, 사용자가 소라카를 믿지 못하고 베인을 직접 조종하면 어떡하죠? 그냥 힐이 없어진 베인이 됐습니다... q를 쓸 때마다 체력이 팍팍 깎일 것이고, 상대에게 맞지도 않았는데 스스로 자멸하겠죠.

- 장점

  사용자가 소라카를 조종하면 베인이 딜에 집중할 수 있으면서, 힐이 들어감.

- 단점

  사용자가 소라카의 위장에 속지 않고 베인을 조종하면 베인이 딜에 집중할 수 있지만, 힐이 들어가지 않음.

<!--토비의 스프링과 매칭: 추상화-->

## 8. 서포터의 제대로 된 위장

소라카가 아무리 베인처럼 꾸며도 사용자가 믿어주지 않을 위험을 극복하기 위해, 이번엔 소라카가 마음먹고 제대로 위장해버립니다. 그리고 이렇게 말하는거죠.

*"봇은 하나 몰라? 원딜과 서포터는 하나고, 너(사용자)가 봇을 조종하는 방법은 서포터인 나를 조정하는 방법밖에 없어~"*

소라카가 완전히 베인으로 위장해버려서, 사용자는 완전히 속아 자기는 베인을 조정하고 있는 줄 알지만 사실은 소라카를 조종하게 됩니다. 이렇게 서포터가 제대로 위장했을 때 장단점은 다음과 같습니다.

- 장점

  사용자가 베인을 직접 조종할 가능성이 거의 없는 채로, 소라카를 조종하여 베인은 딜에 집중할 수 있으면서 힐이 들어감.

- 단점

  1. 위장의 어려움: 소라카가 사용자를 속이려면 베인이랑 비슷하게 생겨야겠지? 이 위장이 어려움. 프로그래밍적으로 생각하면, 소라카가 베인을 구현하는 게 어려움. 베인이 조금 수정되면(예를 들어 q스킬 이름이 a로 바뀐다거나, 새로운 공격스킬 t가 생긴다거나 등), 소라카도 위장을 새로 해야함. 심지어 힐이랑 별로 관련없는 부분도 위장해야 함. 예를 들어, 베인이 w를 쓸 땐 체력이 안달아서 힐이 필요없어도 소라카는 그 부분을 위장해야 함. 
  2. 힐 반복이 생김. 예를 들어, 베인이 w만 빼고 q,e,r 모두 힐이 필요하다고 하면 그 모든 부분에서 힐을 반복적으로 해줘야 함.

  두번째 문제는 메소드 분리로 어떻게든 깔끔하게 처리할 수 있을 것 같은데, 첫번째 문제는 근본적인 문제이기 때문에 해결이 쉽지 않음.

<!--토비의 스프링과 매칭: 프록시-->

## 9. 치트키와 (자바)서포터 공장의 적용 - 소라카, 나는야 화이트 해커!

8번에서 소라카가 베인처럼 위장하는 게 어렵다고 했습니다. 위장을 좀 더 쉽게하는 방법이 없을까요? 자바에서 제공하는 서포터 공장을 활용하면 해결할 수 있습니다. 서포터 공장이 다음과 같이 말합니다.

*"베인 정보 주면, 걔 해킹해서 신상정보 탈탈 턴 다음에 베인처럼 위장한 서포터 만들어줄게~"*

베인을 위장한 서포터를 만들기 위해 매번 코딩해야 했다면, 이제 서포터 공장 두고 베인 정보 주면 서포터가 소라카인지 타릭인지는 모르겠지만 어쨌든 베인을 위장한 서포터를 만들어주게 됩니다.

물론 공장이 있다고 해도 서포팅(힐)의 핵심 부분은 코딩해줘야 합니다. 예를 들어, 힐이 체력 +100일 수도 있고, 체력 +300일 수도 있겠죠. 사용자는 이런 정보를 서포터 공장에게 전달하고, **서포터 공장은 해당 정보를 활용해 조수를 만듭니다(이 부분 다시 확인하기!).**

사용자가 서포터 공장에게 베인 정보와 힐 정보를 주면서 위장된 서포터를 만들어달라고 합니다. 사용자가 위장된 서포터에게 베인 q를 시키면 위장된 서포터는 베인을 해킹하여 베인 q정보를 알아냅니다. 그리고 조수에게 "베인 q 써야해!"라고 알리고, 조수는 그게 q인지 w인지 신경도 안쓰고 베인에게 시킵니다. 그리고 **위장된 서포터가 베인에게 힐을 줍니다(이 부분 다시 확인하기!).**

- 장점
  1. 공장과 해킹을 통해 위장된 서포터를 쉽게 만들 수 있음.
  2. 원딜이 뭐든 상관이 없어짐. 이전에는 귀족 베인만 됐다면, 이제 클래식 베인이든 달빛 베인이든, 케틀이든 상관이 없어짐.
  3. 조수를 둠으로써, 스킬이 뭐든 상관없이 베인에게 시킬 수 있게 됐기 때문에 힐 반복 문제를 해결할 수 있음.
  4. 베인의 q에만 힐 적용, q와 e에 힐 적용 등 선택적 힐 적용이 가능해짐.
- 단점
  1. 위장된 서포터의 공유가 어려워짐. 우리는 이미 추상화한 것들을 빈으로 등록하고, 필요한 곳에서 의존성을 주입받고 사용하던 것을 알고 있음. 위장된 서포터도 잘 만들었으니, 한 번 만들고나서 공유하고 싶음. 다만 위장된 서포터가 소라카인지 타릭인지 그 정체도 모르기 때문에 빈 등록을 할 수가 없음.

## 10. 위장된 서포터의 공유? 공장의 공유!

위에서 위장된 서포터를 공유하기 위한 빈 등록이 어렵다고 했습니다. 사실 기존과는 다른 방식으로 등록할 수 있는데, 위장된 서포터 자체를 등록하는 것이 아니라 위장된 서포터를 만들어주는 서포터 공장을 등록하는 것입니다. 서포터 공장을 공유하면, 공장을 주입받는 쪽에선 이게 공장인지 모르고, 공장이 만들어 준 위장된 서포터라고 생각하고 사용하게 됩니다. 즉 서포터 공장 = 위장된 서포터처럼 되는 것입니다.

이렇게 함으로써 위장된 서포터를 공유할 수 있게 됐지만 문제가 생기는데, 먼저 베인을 테스트하기 어려워졌다는 것입니다. 이전에는 위장된 서포터를 테스트를 하기 위해 공장을 직접 만들고 베인을 위한 서포터를 만들어서 테스트할 것인 지, 케이틀린을 위한 서포터를 만들어서 테스트할 것인 지 개발자가 정해줄 수 있었습니다. 이제 공장을 게시판에 등록하면서 원딜 정보를 게시판에 적어두다보니까, 한 번 게시판에 등록한 위장된 서포터를 테스트용으로 수정하기 어려워졌습니다. 그러니까 서포터 공장한테 처음엔 베인을 위한 위장된 서포터를 만들어달라고 했다가, 테스트할 땐 케이틀린을 위한 위장된 서포터를 만들어달라고 하기가 어려워진 것입니다. 이것은 크게 어렵지 않게 해결할 수 있는데, 테스트할 때 아예 게시판을 가지고 와서 게시판에다가 서포터, 공장 정보 줘서 공장을 가져오고, 공장한테 원딜 정보 준 후 위장된 서포터를 생성하라고 하면 내가 원하는 위장된 서포터를 테스트할 수 있게 됩니다. 

또 문제가 있는데, 이건 위의 테스트가 어려워졌다는 문제보다 큰 문제입니다. 위장된 서포터를 공유하기 위해 게시판에 서포터 공장을 등록했었죠? 그러다보니까 공장을 많이 등록할 수록 게시판이 복잡해진다는 것입니다. 우리의 목적(베인이 딜에 집중할 수 있게 하면서, 위장된 서포터를 만들기 쉽게 하고, 위장된 서포터를 공유할 수 있게까지 하는 것)을 달성하기 위해 게시판을 활용하는 것만으로는 부족합니다. 다음과 같은 점 때문입니다.

1. 베인한테 힐 적용하기는 쉬운데, 베인한테도 힐 적용하고, 케틀한테도 힐 적용하고... 하는 게 어렵습니다. 가능하긴 한데, 서포터 공장 설정을 여러번 해줘야 합니다. 힐 주는 건 똑같은데 베인이냐 케틀이냐에 따라 유사한 설정을 반복해야 합니다.
2. 베인한테 힐도 주고 방어막도 주고 싶을 때도 문제입니다. 부가기능이 많아질수록 공장 설정이 많아질 수밖에 없습니다(베인, 케틀에 따라 조수가 중복됩니다).

위장된 서포터를 수정하지 않아도, 게시판만 수정함으로써 무수한 스킬(베인의 q, w 등)에 힐을 적용할 수 있다는 것은 큰 장점이지만, 게시판이 난장판이 되는 한계가 있는 것입니다. 이를 해결하기 위해 조수의 중복을 없애고 여러 원딜에게 적용 가능한 위장 서포터를 만들고 싶습니다.

- 장점

  여러 사용자가 위장된 서포터를 공유하여 사용할 수 있게 됨.

- 단점

  1. 난장판이 된 게시판
  2. 위장된 서포터를 테스트하기가 조금 어려워짐

<!--토비의 스프링과 매칭: 팩토리 di, di설정의 복잡함-->

## 11. 스프링의 서포터 공장

### (1) 자바 공장 vs 스프링 공장 1 : 조수 vs 향상된조수 

조수 대신 향상된조수가 등장합니다. 향상된 조수가 다음과 같이 말합니다.

*"베인, 너만 네 일에 집중하냐? 나도 내 일에만 집중할거야!"*

스프링은 공장을 잘 추상화해놨습니다. 기존 자바 공장은 사실상 힐(부가기능) 역할도 맡았다고 할 수 있습니다. 스프링이 제공하는 공장을 활용하면, 서포터(힐)을 공장에서 분리할 수 있습니다.

여기서 향상된조수가 활용되는데, 기존의 조수와 다른 점은 베인 정보를 아느냐, 모르느냐 입니다. 기존 조수는 베인에게 q를 시킬 때 베인 정보를 전달받지 않습니다. q인지 w인지 뭔지도 모르고, 뭐든 베인한테 시키라고 하면 시키는 겁니다. 반면, 향상된조수는 베인에게 q를 시킬 때 베인 정보를 전달받습니다. 즉, 기존의 조수는 직접 베인 정보를 알고 있었고, 향상된 조수는 직접 알지 않아도 q를 시켜야할 때 누군가 베인 정보도 알려줍니다. 향상된조수 대신, 스프링공장이 베인 정보를 알고 있습니다. 스프링공장이 귀족 베인을 통해 베인 정보를 얻어, 향상된 조수에게 스킬정보(q 등) 뿐만 아니라 베인 정보도 향상된조수에게 전달하는 것입니다. 따라서 향상된조수는 베인으로부터 독립할 수 있고, 베인한테도 적용 가능할 뿐만 아니라 케틀한테도 적용가능하게 되는 것입니다.  또한 게시판에 등록되어 공유될 수도 있습니다. 여기에서 향상된조수의 조수가 나오는데, 실질적으로 베인에게 q를 시키는 것은 향상된조수의 조수입니다. 향상된조수의 조수가 베인에게 q시키는 것을 담당해준 덕분에, 향상된 조수는 진짜 힐만 신경쓰면 됩니다. 여기에서 템플릿/콜백 패턴이 사용되는데, 향상된조수는 힐만 쓰는 템플릿이고, 향상된조수의 조수는 콜백입니다. 향상된조수의 조수 역시 게시판에 등록하여 공유 가능합니다.

하나의 스프링 서포터 공장은 여러 개의 향상된 조수를 가질 수 있고, 따라서 하나의 공장으로 여러 부가기능(힐, 방어막 등)을 제공해줄 수 있게 됐습니다. 즉, 부가기능을 늘릴 때마다 공장을 만들어야 하는(설정해야 하는) 문제를 해결했습니다.

향상된조수를 쓰니 조수를 쓸 때보다 간결한데, 치트키(리플렉션)을 통한 베인 q 호출의 번거로움이 없어졌고(아마 아예 없어진 건 아니고 향상된조수의 조수가 치트키를 쓰는 것 같습니다. 코드로 확인해봐야 할 것 같습니다), 예외 처리도 간결해졌습니다.

### (2) 자바 공장 vs 스프링 공장 2 : 베인 정보를 앎 vs 베인 정보를 모름

스프링의 서포터 공장이 자바의 서포터 공장과 다른 두번째는 공장을 만들 때 공장에게 베인 정보를 주지 않아도 된다는 것입니다. 자바 공장에서는 베인을 위한 위장된 서포터를 만들기 위해 베인 정보를 줘야 했는데, 스프링 공장을 활용하면 그러지 않아도 되는 것이죠. 스프링은 어떻게 베인을 알지도 못하면서 베인을 위한 서포터를 만들어줄 수 있을까요? 그것은 스프링 공장에 인터페이스 자동 검출 기능이 있기 때문입니다. 귀족 베인을 통해 베인 정보를 알 수 있는 것이죠. 베인 정보를 알아낸 후 베인을 위한 서포터를 만들 수 있게 됩니다.

### (3) 향상된조수의 친구 등장: 힐 받으실 분^^

향상된 조수가 베인 정보를 가지지 않기 때문에, 향상된 조수는 누구에게 힐을 적용해야할 지 모릅니다. 누군가 베인 정보를 전달해줄 것이라고 기대할 뿐이죠. 이것은 토비의스프링 1장~5장에서 계속 해오던 방식으로 해결할 수 있습니다. 성격이 다른 코드를 분리하는 것이죠.

기존 조수는 자기가 베인 정보를 알고있기 때문에, 케틀한테는 적용할 수가 없었습니다. 베인, 케틀을 전략으로 뺀다고 해도 di를 통해 런타임 시 한 번 타깃이 베인으로 결정나면, 다이내믹하게 케틀로 바꿀 수가 없죠. 반면 스프링 공장을 활용하면 향상된조수는 타깃이 베인인지 케틀인지 알지도 못하고 향상된조수의 친구가 타깃을 결정해줍니다.

향상된조수는 기존 조수와 다르게 위장된 서포터가 유저로부터 받는 요청(베인 q 등)을 일일이 전달받을 필요가 없습니다. 향상된 조수는 힐만 하고, 대신 다른 애가 어떤 스킬을 적용할 지 알고 있죠. 향상된조수가 베인 및 스킬정보를 알 필요 없도록, 위장된 서포터가 베인 및 스킬정보를 알고 있게 합시다.

향상된조수와 향상된조수의 친구는 모두 위장된 서포터에 di됩니다. 역할을 분리했기 때문에, 위장된 서포터가 쉽게 공유될 수 있습니다. **여기까지 적용했을 때 베인 정보를 가지고 있는 애는 향상된조수의조수입니다(???확인해보기!)**.

### (4) 스프링 공장을 적용했을 때의 흐름

1. 유저가 위장된 서포터에게 베인 q를 요청합니다.
2. 위장된 서포터는 먼저 향상된조수의 친구에게 베인 q가 힐이 필요한 지 물어봅니다.
3. 위장된 서포터가 확인하고나면, 향상된 조수에게 요청합니다.
4. 향상된조수는 직접 베인에게 q를 하라고 시키진 않습니다. 향상된조수는 공유돼야해서(여러 위장된 서포터가 공유할 수 있습니다), 베인 정보를 갖고있지 않기 때문입니다.
5. 향상된 조수는 힐을 베이스로 깔아둡니다. 힐에만 관심이 있습니다.
6. 향상된 조수는 힐을 쓰는 중간에, 베인 q가 필요하다 싶으면 위장된 서포터로부터 받은 향상된조수의 조수에게 베인 q인지, 베인 w인지, 케틀 q인지 뭔지는 모르겠지만 뭐든 실행하라고 시킵니다.

위장된 서포터로부터 향상된 조수와 향상된 조수의 친구를 나누고, di를 적용한 것은 전형적인 전략패턴입니다. 덕분에 여러 위장된 서포터가 향상된조수, 향상된조수의 친구를 공유할 수 있게 됐습니다. 향상된조수와 향상된조수의 친구의 구체적 로직이 바뀌면 그 때 코드를 좀 수정해주면 됩니다. 위장된 서포터와 스프링 공장은 바뀌지 않으면서 기능을 확장할 수 있기 때문에 OCP를 잘 지켰다고 할 수 있습니다.

<!--토비의 스프링과 매칭: 스프링 팩토리-->